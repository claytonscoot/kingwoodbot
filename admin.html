<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Astro Outdoor Designs ‚Äì Command Center</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
  :root {
    --orange: #e87722;
    --orange-dim: #c4611a;
    --orange-glow: rgba(232,119,34,0.15);
    --bg: #0d0d0d;
    --surface: #141414;
    --surface2: #1c1c1c;
    --surface3: #242424;
    --border: #2a2a2a;
    --text: #f0f0f0;
    --text-dim: #888;
    --text-muted: #555;
    --green: #22c55e;
    --red: #ef4444;
    --blue: #3b82f6;
    --yellow: #eab308;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(232,119,34,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(232,119,34,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .sidebar {
    position: fixed;
    left: 0; top: 0; bottom: 0;
    width: 220px;
    background: var(--surface);
    border-right: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    z-index: 100;
    padding: 24px 0;
  }

  .logo { padding: 0 20px 24px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
  .logo-name { font-family: 'Bebas Neue', sans-serif; font-size: 22px; color: var(--orange); letter-spacing: 1px; line-height: 1.1; }
  .logo-sub { font-size: 10px; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; margin-top: 2px; }

  .nav-section { padding: 0 12px; margin-bottom: 8px; }
  .nav-label { font-size: 10px; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; padding: 0 8px; margin-bottom: 6px; }

  .nav-item {
    display: flex; align-items: center; gap: 10px;
    padding: 9px 12px; border-radius: 8px;
    color: var(--text-dim); font-size: 13px; font-weight: 500;
    cursor: pointer; transition: all 0.15s; margin-bottom: 2px; text-decoration: none;
  }
  .nav-item:hover { background: var(--surface3); color: var(--text); }
  .nav-item.active { background: var(--orange-glow); color: var(--orange); border: 1px solid rgba(232,119,34,0.2); }
  .nav-item .icon { font-size: 16px; width: 20px; text-align: center; }

  .nav-badge {
    margin-left: auto;
    background: var(--orange);
    color: white;
    font-size: 10px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
  }

  .sidebar-footer { margin-top: auto; padding: 16px 20px; border-top: 1px solid var(--border); }
  .status-dot { display: inline-block; width: 8px; height: 8px; background: var(--green); border-radius: 50%; margin-right: 6px; animation: pulse 2s infinite; }
  @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
  .status-text { font-size: 12px; color: var(--text-dim); }

  .main { margin-left: 220px; padding: 32px; position: relative; z-index: 1; min-height: 100vh; }

  .page-section { display: none; }
  .page-section.active { display: block; }

  .topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; }
  .page-title { font-family: 'Bebas Neue', sans-serif; font-size: 36px; color: var(--text); letter-spacing: 1px; }
  .page-title span { color: var(--orange); }
  .topbar-right { display: flex; align-items: center; gap: 12px; }

  .refresh-btn {
    background: var(--surface2); border: 1px solid var(--border); color: var(--text-dim);
    padding: 8px 16px; border-radius: 8px; font-size: 13px; cursor: pointer;
    font-family: 'DM Sans', sans-serif; transition: all 0.15s; display: flex; align-items: center; gap: 6px;
  }
  .refresh-btn:hover { border-color: var(--orange); color: var(--orange); }

  .sheets-btn {
    background: var(--orange); border: none; color: white;
    padding: 8px 16px; border-radius: 8px; font-size: 13px; font-weight: 600;
    cursor: pointer; font-family: 'DM Sans', sans-serif; text-decoration: none;
    display: flex; align-items: center; gap: 6px; transition: background 0.15s;
  }
  .sheets-btn:hover { background: var(--orange-dim); }
  .last-updated { font-size: 12px; color: var(--text-muted); font-family: 'DM Mono', monospace; }

  .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 28px; }

  .stat-card {
    background: var(--surface); border: 1px solid var(--border); border-radius: 12px;
    padding: 20px; position: relative; overflow: hidden; transition: border-color 0.2s;
  }
  .stat-card:hover { border-color: var(--orange); }
  .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: var(--orange); opacity: 0; transition: opacity 0.2s; }
  .stat-card:hover::before { opacity: 1; }
  .stat-label { font-size: 11px; color: var(--text-muted); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 10px; }
  .stat-value { font-family: 'Bebas Neue', sans-serif; font-size: 42px; color: var(--text); line-height: 1; margin-bottom: 6px; }
  .stat-sub { font-size: 12px; color: var(--text-dim); }
  .stat-icon { position: absolute; right: 16px; top: 16px; font-size: 28px; opacity: 0.15; }

  .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
  .section-title { font-family: 'Bebas Neue', sans-serif; font-size: 22px; letter-spacing: 1px; color: var(--text); }
  .section-title span { color: var(--orange); }
  .badge { background: var(--orange-glow); color: var(--orange); border: 1px solid rgba(232,119,34,0.3); padding: 3px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }

  .leads-container { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; margin-bottom: 28px; }
  .leads-toolbar { padding: 16px 20px; border-bottom: 1px solid var(--border); display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

  .search-box {
    background: var(--surface3); border: 1px solid var(--border); color: var(--text);
    padding: 8px 14px; border-radius: 8px; font-size: 13px; font-family: 'DM Sans', sans-serif;
    outline: none; width: 220px; transition: border-color 0.15s;
  }
  .search-box:focus { border-color: var(--orange); }
  .search-box::placeholder { color: var(--text-muted); }

  .filter-btn {
    background: var(--surface3); border: 1px solid var(--border); color: var(--text-dim);
    padding: 8px 14px; border-radius: 8px; font-size: 12px; cursor: pointer;
    font-family: 'DM Sans', sans-serif; transition: all 0.15s;
  }
  .filter-btn:hover, .filter-btn.active { border-color: var(--orange); color: var(--orange); background: var(--orange-glow); }

  table { width: 100%; border-collapse: collapse; }
  thead tr { background: var(--surface2); }
  th { padding: 12px 16px; text-align: left; font-size: 10px; letter-spacing: 1.5px; text-transform: uppercase; color: var(--text-muted); font-weight: 600; border-bottom: 1px solid var(--border); white-space: nowrap; }
  td { padding: 14px 16px; font-size: 13px; border-bottom: 1px solid rgba(42,42,42,0.6); vertical-align: top; }
  tr:last-child td { border-bottom: none; }
  tbody tr { transition: background 0.1s; cursor: pointer; }
  tbody tr:hover { background: var(--surface2); }

  .lead-name { font-weight: 600; color: var(--text); }
  .lead-phone { font-family: 'DM Mono', monospace; font-size: 12px; color: var(--orange); }
  .lead-email { font-size: 12px; color: var(--text-dim); }
  .lead-area { font-size: 12px; color: var(--text-dim); }
  .lead-details { font-size: 12px; color: var(--text-dim); max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .lead-time { font-family: 'DM Mono', monospace; font-size: 11px; color: var(--text-muted); }

  .contact-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
  .contact-text { background: rgba(59,130,246,0.15); color: #60a5fa; }
  .contact-call { background: rgba(34,197,94,0.15); color: #4ade80; }
  .contact-email { background: rgba(234,179,8,0.15); color: #fbbf24; }

  .status-badge { display: inline-flex; align-items: center; gap: 4px; padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
  .status-new { background: rgba(232,119,34,0.15); color: var(--orange); }
  .status-contacted { background: rgba(34,197,94,0.15); color: #4ade80; }
  .status-closed { background: rgba(85,85,85,0.3); color: var(--text-muted); }

  /* Chat session specific */
  .session-form-yes { background: rgba(34,197,94,0.15); color: #4ade80; padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
  .session-form-no { background: rgba(232,119,34,0.15); color: var(--orange); padding: 3px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
  .session-preview { font-size: 12px; color: var(--text-muted); max-width: 240px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-style: italic; }
  .session-msgs { font-family: 'DM Mono', monospace; font-size: 12px; color: var(--text-dim); }

  /* Transcript modal */
  .transcript-box {
    background: var(--surface2);
    border-radius: 8px;
    padding: 16px;
    max-height: 400px;
    overflow-y: auto;
    font-family: 'DM Mono', monospace;
    font-size: 12px;
    line-height: 1.7;
    color: var(--text-dim);
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* Modal */
  .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 200; justify-content: center; align-items: center; padding: 20px; backdrop-filter: blur(4px); }
  .modal-overlay.open { display: flex; }
  .modal-box { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; width: 100%; max-width: 560px; padding: 28px; position: relative; animation: modalIn 0.2s ease; max-height: 90vh; overflow-y: auto; }
  @keyframes modalIn { from { opacity: 0; transform: scale(0.96) translateY(8px); } to { opacity: 1; transform: scale(1) translateY(0); } }

  .modal-close-btn { position: absolute; top: 16px; right: 16px; background: var(--surface3); border: 1px solid var(--border); color: var(--text-dim); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center; }
  .modal-close-btn:hover { color: var(--text); border-color: var(--orange); }
  .modal-lead-name { font-family: 'Bebas Neue', sans-serif; font-size: 28px; color: var(--text); margin-bottom: 4px; }
  .modal-timestamp { font-size: 12px; color: var(--text-muted); font-family: 'DM Mono', monospace; margin-bottom: 20px; }
  .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
  .modal-field { background: var(--surface2); border-radius: 8px; padding: 12px; }
  .modal-field-label { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; }
  .modal-field-value { font-size: 14px; color: var(--text); font-weight: 500; }
  .modal-field-value.phone { color: var(--orange); font-family: 'DM Mono', monospace; }
  .modal-details { background: var(--surface2); border-radius: 8px; padding: 14px; margin-bottom: 16px; }
  .modal-details-label { font-size: 10px; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; }
  .modal-details-text { font-size: 14px; color: var(--text); line-height: 1.6; }
  .modal-actions { display: flex; gap: 10px; }
  .modal-action-btn { flex: 1; padding: 12px; border-radius: 10px; font-size: 13px; font-weight: 600; cursor: pointer; font-family: 'DM Sans', sans-serif; border: none; transition: all 0.15s; display: flex; align-items: center; justify-content: center; gap: 6px; text-decoration: none; }
  .btn-call { background: var(--green); color: #000; }
  .btn-call:hover { background: #16a34a; }
  .btn-text { background: var(--blue); color: white; }
  .btn-text:hover { background: #2563eb; }
  .btn-email { background: var(--surface3); color: var(--text); border: 1px solid var(--border); }
  .btn-email:hover { border-color: var(--orange); color: var(--orange); }
  .btn-transcript { background: var(--surface3); color: var(--orange); border: 1px solid rgba(232,119,34,0.4); }
  .btn-transcript:hover { background: var(--orange-glow); }

  .bottom-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 28px; }
  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
  .quick-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  .action-card { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 16px; cursor: pointer; transition: all 0.15s; text-decoration: none; display: block; }
  .action-card:hover { border-color: var(--orange); background: var(--orange-glow); }
  .action-icon { font-size: 24px; margin-bottom: 8px; }
  .action-label { font-size: 13px; font-weight: 600; color: var(--text); margin-bottom: 3px; }
  .action-sub { font-size: 11px; color: var(--text-muted); }

  .tip-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); }
  .tip-item:last-child { border-bottom: none; padding-bottom: 0; }
  .tip-num { font-family: 'Bebas Neue', sans-serif; font-size: 24px; color: var(--orange); line-height: 1; min-width: 28px; }
  .tip-text { font-size: 13px; color: var(--text-dim); line-height: 1.5; }
  .tip-text strong { color: var(--text); }

  .empty-state { padding: 48px; text-align: center; color: var(--text-muted); }
  .empty-state .big-icon { font-size: 48px; margin-bottom: 12px; opacity: 0.4; }
  .empty-state p { font-size: 14px; }
  .loading-row td { color: var(--text-muted); font-style: italic; text-align: center; padding: 32px; }

  .priority-alert { background: linear-gradient(135deg, rgba(232,119,34,0.15), rgba(232,119,34,0.05)); border: 1px solid rgba(232,119,34,0.4); border-radius: 10px; padding: 14px 18px; margin-bottom: 20px; display: none; align-items: center; gap: 12px; }
  .priority-alert.show { display: flex; }
  .priority-alert-icon { font-size: 22px; }
  .priority-alert-text { font-size: 13px; color: var(--text); }
  .priority-alert-text strong { color: var(--orange); }

  /* Chat-only warning banner */
  .chat-only-banner { background: rgba(232,119,34,0.08); border: 1px solid rgba(232,119,34,0.25); border-radius: 10px; padding: 12px 18px; margin-bottom: 20px; font-size: 13px; color: var(--text-dim); display: none; }
  .chat-only-banner.show { display: block; }
  .chat-only-banner strong { color: var(--orange); }

  @media (max-width: 1100px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } .bottom-grid { grid-template-columns: 1fr; } }
  @media (max-width: 768px) { .sidebar { display: none; } .main { margin-left: 0; padding: 16px; } .stats-grid { grid-template-columns: repeat(2, 1fr); } .quick-actions { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <div class="logo">
    <div class="logo-name">Astro Outdoor<br>Designs</div>
    <div class="logo-sub">Command Center</div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Main</div>
    <a class="nav-item active" id="nav-dashboard" onclick="showPage('dashboard', this)">
      <span class="icon">üìä</span> Dashboard
    </a>
    <a class="nav-item" id="nav-leads" onclick="showPage('leads', this)">
      <span class="icon">üéØ</span> Form Leads
    </a>
    <a class="nav-item" id="nav-sessions" onclick="showPage('sessions', this)">
      <span class="icon">üí¨</span> Chat Sessions
      <span class="nav-badge" id="chatOnlyBadge" style="display:none">0</span>
    </a>
  </div>

  <div class="nav-section" style="margin-top:12px;">
    <div class="nav-label">Quick Links</div>
    <a class="nav-item" href="https://docs.google.com/spreadsheets/d/1RodpbvL75F8AZxutqKcTY_vrbxZvylSBv1SggglPGlM" target="_blank">
      <span class="icon">üìã</span> Google Sheets
    </a>
    <a class="nav-item" href="/" target="_blank">
      <span class="icon">üí¨</span> Live Chat
    </a>
    <a class="nav-item" href="https://astrooutdoordesigns.com" target="_blank">
      <span class="icon">üåê</span> Website
    </a>
    <a class="nav-item" href="https://dashboard.render.com" target="_blank">
      <span class="icon">‚öôÔ∏è</span> Render
    </a>
  </div>

  <div class="sidebar-footer">
    <div><span class="status-dot"></span><span class="status-text" id="serverStatus">Checking...</span></div>
  </div>
</div>

<!-- MAIN -->
<div class="main">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- PAGE: DASHBOARD -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page-section active" id="page-dashboard">
    <div class="topbar">
      <div>
        <div class="page-title">Lead <span>Command</span></div>
        <div class="last-updated" id="lastUpdated">Loading...</div>
      </div>
      <div class="topbar-right">
        <button class="refresh-btn" onclick="loadData()">‚Üª Refresh</button>
        <a class="sheets-btn" href="https://docs.google.com/spreadsheets/d/1RodpbvL75F8AZxutqKcTY_vrbxZvylSBv1SggglPGlM" target="_blank">
          üìã Google Sheets
        </a>
      </div>
    </div>

    <div class="priority-alert" id="priorityAlert">
      <div class="priority-alert-icon">üî•</div>
      <div class="priority-alert-text"><strong id="priorityCount">0</strong> priority callback request(s) waiting ‚Äî call them now!</div>
    </div>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-label">Form Leads</div>
        <div class="stat-value" id="statTotal">‚Äî</div>
        <div class="stat-sub">Submitted quotes</div>
        <div class="stat-icon">üéØ</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Today's Leads</div>
        <div class="stat-value" id="statToday">‚Äî</div>
        <div class="stat-sub" id="statTodayDate">‚Äî</div>
        <div class="stat-icon">üìÖ</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Chat Sessions</div>
        <div class="stat-value" id="statSessions">‚Äî</div>
        <div class="stat-sub">Active + recent</div>
        <div class="stat-icon">üí¨</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Chat-Only Visitors</div>
        <div class="stat-value" id="statChatOnly">‚Äî</div>
        <div class="stat-sub">No form submitted</div>
        <div class="stat-icon">üëÄ</div>
      </div>
    </div>

    <!-- Recent leads preview -->
    <div class="section-header">
      <div class="section-title">Recent <span>Leads</span></div>
      <div style="display:flex;gap:10px;align-items:center;">
        <div class="badge" id="leadsCountDash">0 leads</div>
        <button class="filter-btn" onclick="showPage('leads', document.getElementById('nav-leads'))">View All ‚Üí</button>
      </div>
    </div>

    <div class="leads-container">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Contact</th>
            <th>Area</th>
            <th>Project</th>
            <th>Pref.</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody id="dashLeadsBody">
          <tr class="loading-row"><td colspan="6">Loading...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Bottom grid -->
    <div class="bottom-grid">
      <div class="card">
        <div class="section-header" style="margin-bottom:14px;">
          <div class="section-title">Quick <span>Actions</span></div>
        </div>
        <div class="quick-actions">
          <a class="action-card" href="https://docs.google.com/spreadsheets/d/1RodpbvL75F8AZxutqKcTY_vrbxZvylSBv1SggglPGlM" target="_blank">
            <div class="action-icon">üìã</div>
            <div class="action-label">All Leads</div>
            <div class="action-sub">Open Google Sheets</div>
          </a>
          <a class="action-card" href="/" target="_blank">
            <div class="action-icon">üí¨</div>
            <div class="action-label">Live Chat</div>
            <div class="action-sub">View customer chatbot</div>
          </a>
          <a class="action-card" href="tel:8322805783">
            <div class="action-icon">üìû</div>
            <div class="action-label">Your Phone</div>
            <div class="action-sub">832-280-5783</div>
          </a>
          <a class="action-card" href="mailto:admin@astrooutdoordesigns.com">
            <div class="action-icon">üìß</div>
            <div class="action-label">Your Email</div>
            <div class="action-sub">admin@astrooutdoor...</div>
          </a>
          <a class="action-card" href="https://www.facebook.com/astrooutdoordesigns" target="_blank">
            <div class="action-icon">üì±</div>
            <div class="action-label">Facebook</div>
            <div class="action-sub">Astro Outdoor Designs</div>
          </a>
          <a class="action-card" href="/health" target="_blank">
            <div class="action-icon">‚öôÔ∏è</div>
            <div class="action-label">Server Health</div>
            <div class="action-sub">Check API status</div>
          </a>
        </div>
      </div>

      <div class="card">
        <div class="section-header" style="margin-bottom:14px;">
          <div class="section-title">Close <span>More Jobs</span></div>
        </div>
        <div class="tip-item">
          <div class="tip-num">1</div>
          <div class="tip-text"><strong>Call within 5 minutes.</strong> Response speed is the #1 factor in winning jobs. The lead is hot right now.</div>
        </div>
        <div class="tip-item">
          <div class="tip-num">2</div>
          <div class="tip-text"><strong>Always upsell steel posts.</strong> Add $6‚Äì8/LF, takes 2 sentences to sell, and customers who go steel refer more friends.</div>
        </div>
        <div class="tip-item">
          <div class="tip-num">3</div>
          <div class="tip-text"><strong>Offer staining on every wood job.</strong> At $0.86/sqft spray it's easy money and protects your install long-term.</div>
        </div>
        <div class="tip-item">
          <div class="tip-num">4</div>
          <div class="tip-text"><strong>Ask for photos before the visit.</strong> Saves drive time. A 2-photo text narrows your estimate and shows professionalism.</div>
        </div>
        <div class="tip-item">
          <div class="tip-num">5</div>
          <div class="tip-text"><strong>Follow up 48hrs after quoting.</strong> Most contractors never follow up. A single text wins jobs your competitors lost.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- PAGE: FORM LEADS -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page-section" id="page-leads">
    <div class="topbar">
      <div>
        <div class="page-title">Form <span>Leads</span></div>
        <div class="last-updated">Customers who submitted the quote form</div>
      </div>
      <div class="topbar-right">
        <button class="refresh-btn" onclick="loadData()">‚Üª Refresh</button>
      </div>
    </div>

    <div class="leads-container">
      <div class="leads-toolbar">
        <input class="search-box" type="text" placeholder="üîç Search name, phone, area..." oninput="filterLeads(this.value)" />
        <button class="filter-btn active" onclick="setFilter('all', this)">All</button>
        <button class="filter-btn" onclick="setFilter('text', this)">Text</button>
        <button class="filter-btn" onclick="setFilter('call', this)">Call</button>
        <button class="filter-btn" onclick="setFilter('email', this)">Email</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Contact</th>
            <th>Area</th>
            <th>Project</th>
            <th>Pref.</th>
            <th>Time</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="leadsTableBody">
          <tr class="loading-row"><td colspan="7">Loading leads...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- PAGE: CHAT SESSIONS -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="page-section" id="page-sessions">
    <div class="topbar">
      <div>
        <div class="page-title">Chat <span>Sessions</span></div>
        <div class="last-updated">All conversations ‚Äî including visitors who never submitted a form</div>
      </div>
      <div class="topbar-right">
        <button class="refresh-btn" onclick="loadSessions()">‚Üª Refresh</button>
      </div>
    </div>

    <div class="chat-only-banner" id="chatOnlyBanner">
      <strong id="chatOnlyCount">0</strong> visitors chatted but never submitted a form ‚Äî these are potential leads you can still chase. Full transcripts are emailed to you automatically after each session.
    </div>

    <div class="stats-grid" style="grid-template-columns: repeat(3,1fr);">
      <div class="stat-card">
        <div class="stat-label">Total Sessions</div>
        <div class="stat-value" id="statTotalSessions">‚Äî</div>
        <div class="stat-sub">All chats in memory</div>
        <div class="stat-icon">üí¨</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Form Submitted</div>
        <div class="stat-value" id="statWithForm">‚Äî</div>
        <div class="stat-sub">Converted to lead</div>
        <div class="stat-icon">‚úÖ</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Chat Only</div>
        <div class="stat-value" id="statNoForm">‚Äî</div>
        <div class="stat-sub">No form ‚Äî missed leads</div>
        <div class="stat-icon">üëÄ</div>
      </div>
    </div>

    <div class="section-header">
      <div class="section-title">All <span>Conversations</span></div>
      <div style="display:flex;gap:8px;">
        <button class="filter-btn active" id="sessFilter-all" onclick="setSessionFilter('all', this)">All</button>
        <button class="filter-btn" id="sessFilter-noform" onclick="setSessionFilter('noform', this)">Chat Only üëÄ</button>
        <button class="filter-btn" id="sessFilter-form" onclick="setSessionFilter('form', this)">Form Submitted ‚úÖ</button>
      </div>
    </div>

    <div class="leads-container">
      <table>
        <thead>
          <tr>
            <th>Session</th>
            <th>Name / Phone</th>
            <th>Messages</th>
            <th>Form?</th>
            <th>Last Message Preview</th>
            <th>Time</th>
            <th>Transcript</th>
          </tr>
        </thead>
        <tbody id="sessionsTableBody">
          <tr class="loading-row"><td colspan="7">Loading sessions...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- LEAD DETAIL MODAL -->
<div class="modal-overlay" id="leadModal" onclick="closeLeadModal(event)">
  <div class="modal-box">
    <button class="modal-close-btn" onclick="document.getElementById('leadModal').classList.remove('open')">√ó</button>
    <div class="modal-lead-name" id="modalName">‚Äî</div>
    <div class="modal-timestamp" id="modalTime">‚Äî</div>
    <div class="modal-grid">
      <div class="modal-field">
        <div class="modal-field-label">Phone</div>
        <div class="modal-field-value phone" id="modalPhone">‚Äî</div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Email</div>
        <div class="modal-field-value" id="modalEmail">‚Äî</div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Area</div>
        <div class="modal-field-value" id="modalArea">‚Äî</div>
      </div>
      <div class="modal-field">
        <div class="modal-field-label">Preferred Contact</div>
        <div class="modal-field-value" id="modalContact">‚Äî</div>
      </div>
    </div>
    <div class="modal-details">
      <div class="modal-details-label">Project Details</div>
      <div class="modal-details-text" id="modalDetails">‚Äî</div>
    </div>
    <div class="modal-actions">
      <a class="modal-action-btn btn-call" id="modalCallBtn" href="#">üìû Call</a>
      <a class="modal-action-btn btn-text" id="modalTextBtn" href="#">üí¨ Text</a>
      <a class="modal-action-btn btn-email" id="modalEmailBtn" href="#">‚úâÔ∏è Email</a>
    </div>
  </div>
</div>

<!-- TRANSCRIPT MODAL -->
<div class="modal-overlay" id="transcriptModal" onclick="closeTranscriptModal(event)">
  <div class="modal-box">
    <button class="modal-close-btn" onclick="document.getElementById('transcriptModal').classList.remove('open')">√ó</button>
    <div class="modal-lead-name" id="transcriptTitle">Chat Transcript</div>
    <div class="modal-timestamp" id="transcriptMeta">‚Äî</div>
    <div class="modal-details" style="margin-bottom:16px;">
      <div class="modal-details-label">Contact Info Captured</div>
      <div class="modal-details-text" id="transcriptContact">‚Äî</div>
    </div>
    <div class="modal-details-label" style="margin-bottom:8px;">Full Conversation</div>
    <div class="transcript-box" id="transcriptContent">Loading...</div>
    <div style="margin-top:16px;display:flex;gap:10px;">
      <a class="modal-action-btn btn-call" id="transcriptCallBtn" href="#" style="display:none">üìû Call</a>
      <a class="modal-action-btn btn-text" id="transcriptTextBtn" href="#" style="display:none">üí¨ Text</a>
    </div>
  </div>
</div>

<script>
  let allLeads = [];
  let allSessions = [];
  let currentFilter = 'all';
  let currentSessionFilter = 'all';

  // ‚îÄ‚îÄ Page navigation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showPage(page, navEl) {
    document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    document.getElementById('page-' + page).classList.add('active');
    if (navEl) navEl.classList.add('active');
    if (page === 'sessions') loadSessions();
  }

  // ‚îÄ‚îÄ Main data load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function loadData() {
    document.getElementById('lastUpdated').textContent = 'Refreshing...';
    try {
      const [statsRes, leadsRes] = await Promise.all([
        fetch('/admin/data'),
        fetch('/admin/leads')
      ]);
      const stats = await statsRes.json();
      const leadsData = await leadsRes.json();

      allLeads = (leadsData.leads || []).reverse();

      document.getElementById('statTotal').textContent = allLeads.length;
      document.getElementById('statToday').textContent = stats.total_leads_today || 0;
      document.getElementById('statSessions').textContent = stats.active_sessions || 0;
      document.getElementById('statTodayDate').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
      document.getElementById('serverStatus').textContent = 'Server online';
      document.getElementById('leadsCountDash').textContent = allLeads.length + ' leads';

      // Priority alert
      const priorityCount = stats.live_quote_requests?.length || 0;
      if (priorityCount > 0) {
        document.getElementById('priorityAlert').classList.add('show');
        document.getElementById('priorityCount').textContent = priorityCount;
      }

      // Dashboard preview (last 5)
      renderDashLeads(allLeads.slice(0, 5));
      renderLeads(allLeads);

      document.getElementById('lastUpdated').textContent = 'Last updated: ' + new Date().toLocaleTimeString();

      // Load session counts for badge
      loadSessionCounts();
    } catch (e) {
      document.getElementById('serverStatus').textContent = 'Connection error';
      document.getElementById('lastUpdated').textContent = 'Failed to load';
    }
  }

  async function loadSessionCounts() {
    try {
      const res = await fetch('/admin/sessions');
      const data = await res.json();
      const chatOnly = data.chat_only || 0;
      document.getElementById('statChatOnly').textContent = chatOnly;

      // Show badge on sidebar nav item if there are chat-only sessions
      const badge = document.getElementById('chatOnlyBadge');
      if (chatOnly > 0) {
        badge.textContent = chatOnly;
        badge.style.display = 'inline-block';
      } else {
        badge.style.display = 'none';
      }
    } catch(e) {
      document.getElementById('statChatOnly').textContent = '‚Äî';
    }
  }

  async function loadSessions() {
    document.getElementById('sessionsTableBody').innerHTML = '<tr class="loading-row"><td colspan="7">Loading sessions...</td></tr>';
    try {
      const res = await fetch('/admin/sessions');
      const data = await res.json();
      allSessions = data.sessions || [];

      document.getElementById('statTotalSessions').textContent = data.total || 0;
      document.getElementById('statWithForm').textContent = data.with_form || 0;
      document.getElementById('statNoForm').textContent = data.chat_only || 0;

      const chatOnly = data.chat_only || 0;
      if (chatOnly > 0) {
        document.getElementById('chatOnlyBanner').classList.add('show');
        document.getElementById('chatOnlyCount').textContent = chatOnly;
      }

      renderSessions(allSessions);
    } catch(e) {
      document.getElementById('sessionsTableBody').innerHTML = '<tr class="loading-row"><td colspan="7">Failed to load sessions</td></tr>';
    }
  }

  // ‚îÄ‚îÄ Render leads table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderDashLeads(leads) {
    const tbody = document.getElementById('dashLeadsBody');
    if (!leads.length) {
      tbody.innerHTML = `<tr><td colspan="6"><div class="empty-state"><div class="big-icon">üì≠</div><p>No leads yet.</p></div></td></tr>`;
      return;
    }
    tbody.innerHTML = leads.map((lead, i) => {
      const contactClass = `contact-${lead.preferred_contact || 'text'}`;
      const timeStr = (lead.timestamp || '').substring(0, 16);
      const details = (lead.details || '').substring(0, 40) + ((lead.details||'').length > 40 ? '...' : '');
      return `<tr onclick="openLead(${i})">
        <td><div class="lead-name">${lead.name||'‚Äî'}</div><div class="lead-phone">${lead.phone||'‚Äî'}</div></td>
        <td><div class="lead-email">${lead.email||'‚Äî'}</div></td>
        <td><div class="lead-area">${lead.area||'‚Äî'}</div></td>
        <td><div class="lead-details">${details||'‚Äî'}</div></td>
        <td><span class="contact-badge ${contactClass}">${(lead.preferred_contact||'text').toUpperCase()}</span></td>
        <td><div class="lead-time">${timeStr}</div></td>
      </tr>`;
    }).join('');
  }

  function renderLeads(leads) {
    const tbody = document.getElementById('leadsTableBody');
    if (!leads.length) {
      tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="big-icon">üì≠</div><p>No leads yet. Submit a test form on the chat page to verify everything is working.</p></div></td></tr>`;
      return;
    }
    tbody.innerHTML = leads.map((lead, i) => {
      const contactClass = `contact-${lead.preferred_contact || 'text'}`;
      const timeStr = (lead.timestamp || '').substring(0, 16);
      const details = (lead.details || '').substring(0, 50) + ((lead.details||'').length > 50 ? '...' : '');
      return `<tr onclick="openLead(${i})">
        <td><div class="lead-name">${lead.name||'‚Äî'}</div><div class="lead-phone">${lead.phone||'‚Äî'}</div></td>
        <td><div class="lead-email">${lead.email||'‚Äî'}</div></td>
        <td><div class="lead-area">${lead.area||'‚Äî'}</div></td>
        <td><div class="lead-details">${details||'‚Äî'}</div></td>
        <td><span class="contact-badge ${contactClass}">${(lead.preferred_contact||'text').toUpperCase()}</span></td>
        <td><div class="lead-time">${timeStr}</div></td>
        <td><span class="status-badge status-${lead.status||'new'}">${lead.status||'new'}</span></td>
      </tr>`;
    }).join('');
  }

  // ‚îÄ‚îÄ Render sessions table ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderSessions(sessions) {
    const tbody = document.getElementById('sessionsTableBody');
    let filtered = sessions;
    if (currentSessionFilter === 'noform') filtered = sessions.filter(s => !s.form_submitted);
    if (currentSessionFilter === 'form') filtered = sessions.filter(s => s.form_submitted);

    if (!filtered.length) {
      tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="big-icon">üí¨</div><p>No chat sessions yet.</p></div></td></tr>`;
      return;
    }

    tbody.innerHTML = filtered.map(s => {
      const name = s.soft_lead_name || '‚Äî';
      const phone = s.soft_lead_phone || '‚Äî';
      const timeStr = (s.last_activity || '').substring(0, 16);
      const formBadge = s.form_submitted
        ? '<span class="session-form-yes">‚úÖ Yes</span>'
        : '<span class="session-form-no">üëÄ Chat only</span>';
      const preview = s.preview || '...';
      return `<tr>
        <td><div class="lead-name" style="font-family:var(--font-mono);font-size:12px;">${s.session_id}</div></td>
        <td><div class="lead-name">${name}</div><div class="lead-phone">${phone !== '‚Äî' ? phone : ''}</div></td>
        <td><div class="session-msgs">${s.message_count}</div></td>
        <td>${formBadge}</td>
        <td><div class="session-preview">${preview}</div></td>
        <td><div class="lead-time">${timeStr}</div></td>
        <td><button class="filter-btn" style="font-size:11px;padding:5px 10px;" onclick="openTranscript('${s.session_id}', event)">üìÑ View</button></td>
      </tr>`;
    }).join('');
  }

  function setSessionFilter(filter, btn) {
    currentSessionFilter = filter;
    document.querySelectorAll('[id^="sessFilter-"]').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderSessions(allSessions);
  }

  // ‚îÄ‚îÄ Open lead modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function openLead(index) {
    const lead = allLeads[index];
    if (!lead) return;
    document.getElementById('modalName').textContent = lead.name || '‚Äî';
    document.getElementById('modalTime').textContent = lead.timestamp || '‚Äî';
    document.getElementById('modalPhone').textContent = lead.phone || '‚Äî';
    document.getElementById('modalEmail').textContent = lead.email || 'Not provided';
    document.getElementById('modalArea').textContent = lead.area || '‚Äî';
    document.getElementById('modalContact').textContent = (lead.preferred_contact || 'text').toUpperCase();
    document.getElementById('modalDetails').textContent = lead.details || '‚Äî';
    document.getElementById('modalCallBtn').href = `tel:${(lead.phone||'').replace(/\D/g,'')}`;
    document.getElementById('modalTextBtn').href = `sms:${(lead.phone||'').replace(/\D/g,'')}`;
    document.getElementById('modalEmailBtn').href = `mailto:${lead.email||''}`;
    document.getElementById('leadModal').classList.add('open');
  }

  // ‚îÄ‚îÄ Open transcript modal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function openTranscript(sessionId, e) {
    e.stopPropagation();
    document.getElementById('transcriptModal').classList.add('open');
    document.getElementById('transcriptTitle').textContent = `Session ${sessionId}`;
    document.getElementById('transcriptContent').textContent = 'Loading transcript...';

    // Find session info
    const sess = allSessions.find(s => s.session_id === sessionId);
    if (sess) {
      document.getElementById('transcriptMeta').textContent =
        `${sess.message_count} messages ¬∑ Last active: ${(sess.last_activity||'').substring(0,16)} ¬∑ ${sess.form_submitted ? '‚úÖ Form submitted' : 'üëÄ Chat only'}`;

      const contactParts = [];
      if (sess.soft_lead_name && sess.soft_lead_name !== '‚Äî') contactParts.push('Name: ' + sess.soft_lead_name);
      if (sess.soft_lead_phone && sess.soft_lead_phone !== '‚Äî') contactParts.push('Phone: ' + sess.soft_lead_phone);
      if (sess.soft_lead_email) contactParts.push('Email: ' + sess.soft_lead_email);
      document.getElementById('transcriptContact').textContent = contactParts.length ? contactParts.join(' ¬∑ ') : 'No contact info captured';

      // Show call/text buttons if phone captured
      if (sess.soft_lead_phone && sess.soft_lead_phone !== '‚Äî') {
        const phone = sess.soft_lead_phone.replace(/\D/g,'');
        document.getElementById('transcriptCallBtn').href = `tel:${phone}`;
        document.getElementById('transcriptTextBtn').href = `sms:${phone}`;
        document.getElementById('transcriptCallBtn').style.display = 'flex';
        document.getElementById('transcriptTextBtn').style.display = 'flex';
      } else {
        document.getElementById('transcriptCallBtn').style.display = 'none';
        document.getElementById('transcriptTextBtn').style.display = 'none';
      }
    }

    try {
      const res = await fetch(`/admin/transcript/${sessionId}`);
      const data = await res.json();
      document.getElementById('transcriptContent').textContent = data.transcript || 'No transcript available.';
    } catch(e) {
      document.getElementById('transcriptContent').textContent = 'Could not load transcript. Session may have expired.';
    }
  }

  // ‚îÄ‚îÄ Filters ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function filterLeads(query) {
    const q = query.toLowerCase();
    let filtered = allLeads;
    if (currentFilter !== 'all') filtered = filtered.filter(l => l.preferred_contact === currentFilter);
    if (q) filtered = filtered.filter(l =>
      (l.name||'').toLowerCase().includes(q) ||
      (l.phone||'').includes(q) ||
      (l.area||'').toLowerCase().includes(q) ||
      (l.email||'').toLowerCase().includes(q) ||
      (l.details||'').toLowerCase().includes(q)
    );
    renderLeads(filtered);
  }

  function setFilter(filter, btn) {
    currentFilter = filter;
    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    filterLeads(document.querySelector('.search-box')?.value || '');
  }

  function closeLeadModal(e) {
    if (e.target === document.getElementById('leadModal')) document.getElementById('leadModal').classList.remove('open');
  }
  function closeTranscriptModal(e) {
    if (e.target === document.getElementById('transcriptModal')) document.getElementById('transcriptModal').classList.remove('open');
  }

  // Auto-refresh every 60 seconds
  loadData();
  setInterval(loadData, 60000);
</script>
</body>
</html>
